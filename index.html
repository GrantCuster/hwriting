<!DOCTYPE html>
<html lang="en">
  <head>
	<meta name="generator" content="Hugo 0.71.1" />
    <meta charset="utf-8">
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
      />
    <link rel="stylesheet" type="text/css" href="/font.css" />
    <link rel="stylesheet" type="text/css" href="/style.css" />
    


<title>Writing - Grant Custer</title>
<meta property="description" content="Writing about alternative interfaces and technology.">
<meta property="og:title" content="Writing - Grant Custer">
<meta property="og:description" content="Writing about alternative interfaces and technology.">
<meta property="og:image" content="https://writing.grantcuster.com/writing.png">
<meta property="og:url" content="https://writing.grantcuster.com/">
<meta property="twitter:card" content="summary_large_image">
<link rel="alternate" type="application/rss+xml" href="https://writing.grantcuster.com/rss.xml" title="Writing - Grant Custer" />

  </head>
  <body>
   <div class="hspacer"></div>
    <div class="container">
      <div class="">
      <div>Grant Custer</div>
      <div><p style="margin: 0; text-indent: 2ch"><a href="https://feed.grantcuster.com">Feed</a>&nbsp; <a href="/">Index</a>&nbsp; <a href="https://twitter.com">Twitter</a></p></div>
      </div>
    </div>
    <div class="spacer"></div>
    
 <div class="container">
   <div>Writing</div> 
      <div>Latest posts</div>
      
      
      <div style="padding-left: 2ch; text-indent: -2ch;">
        2020.07.12 <a href="/posts/2020-07-12-swapping-color-schemes-across-all-terminals-and-vim-with-pywal-and-base16/">Swapping color schemes across all terminals and Vim with Pywal and Base16</a>
      </div>
      
      
      <div style="padding-left: 2ch; text-indent: -2ch;">
        2020.06.25 <a href="/posts/2020-06-25-vimlike/">Vimlike</a>
      </div>
      
      <div class="spacer"></div>
      <div>***</div>
      <div class="spacer"></div>
 
      
      
      <div class="post">
        <div class="jbm">2020.07.12</div>
        <h1><a href="/posts/2020-07-12-swapping-color-schemes-across-all-terminals-and-vim-with-pywal-and-base16/">Swapping color schemes across all terminals and Vim with Pywal and Base16</a></h1>
        <div><figure>
    <img src="/images/gif-2020-07-11_08-51-21@2x-1594472001.gif"/> <figcaption>
            <h4>Switching between light and dark colorschemes in all terminals using a hotkey.</h4>
        </figcaption>
</figure>

<p>I recently got instant light and dark color scheme toggle working for all open terminals, including those running Vim. I used a combination of techniques from <a href="https://github.com/dylanaraps/pywal">Pywal</a> and <a href="https://github.com/chriskempson/base16-shell">Base16 shell</a>, and learned some things about scripting in Linux and escape sequences along the way.</p>
<h2 id="pywal">Pywal</h2>
<p><a href="https://github.com/dylanaraps/pywal">Pywal</a> is a package for switching color schemes system wide. Mostly it is known for generating those color schemes from images, but it also comes bundled with a bunch of predefined themes. I wanted to use it to switch between <a href="https://github.com/morhetz/gruvbox">gruvbox</a> light and dark themes.</p>
<p>Pywal can change the color schemes for all open terminals automatically. It can also switch colors for several other Linux applications.</p>
<h3 id="how-pywal-works">How Pywal works</h3>
<p>This is what the gruvbox dark theme looks like in Pywal&rsquo;s colorschemes directory:</p>
<pre><code># Pywal gruvbox colorscheme
{
  &quot;special&quot;: {
    &quot;background&quot;: &quot;#282828&quot;,
    &quot;foreground&quot;: &quot;#a89984&quot;,
    &quot;cursor&quot;: &quot;#ebdbb2&quot;
  },
  &quot;colors&quot;: {
    &quot;color0&quot;: &quot;#282828&quot;,
    &quot;color1&quot;: &quot;#cc241d&quot;,
    &quot;color2&quot;: &quot;#d79921&quot;,
    &quot;color3&quot;: &quot;#b58900&quot;,
    &quot;color4&quot;: &quot;#458588&quot;,
    &quot;color5&quot;: &quot;#b16286&quot;,
    &quot;color6&quot;: &quot;#689d6a&quot;,
    &quot;color7&quot;: &quot;#a89984&quot;,
    &quot;color8&quot;: &quot;#928374&quot;,
    &quot;color9&quot;: &quot;#cc241d&quot;,
    &quot;color10&quot;: &quot;#d79921&quot;,
    &quot;color11&quot;: &quot;#b58900&quot;,
    &quot;color12&quot;: &quot;#458588&quot;,
    &quot;color13&quot;: &quot;#b16286&quot;,
    &quot;color14&quot;: &quot;#689d6a&quot;,
    &quot;color15&quot;: &quot;#a89984&quot;
  }
}
</code></pre><p>A JSON file declaring each color. OK, but how do those colors get communicated to the applications? The <a href="https://github.com/dylanaraps/pywal/wiki/Customization">customization</a> instructions mention <code>~/.cache/wal</code> a lot, so let&rsquo;s see what&rsquo;s in there:</p>
<pre><code># ls ~/.cache/wal
colors                      colors-putty.reg         colors-tty.sh        colors.Xresources
colors.css                  colors-rofi-dark.rasi    colors-wal-dmenu.h   colors.yml
colors.hs                   colors-rofi-light.rasi   colors-wal-dwm.h     sequences
colors.json                 colors.scss              colors-wal-st.h      wal
colors-kitty.conf           colors.sh                colors-wal-tabbed.h
colors-konsole.colorscheme  colors-speedcrunch.json  colors-wal.vim
colors-oomox                colors-sway              colors-waybar.css
</code></pre><p>Ah! It&rsquo;s using the JSON color schemes to generate application specific color scheme files. This is  a great example of figuring out which level of abstraction to intervene at: Pywal defines a standard color scheme spec and uses application specific templates to generate files from it. If anyone wants to add a new color scheme or application template the procedure for doing so is clear and self-contained.</p>
<h3 id="live-reload-and-escape-sequences">Live reload and escape sequences</h3>
<p>To change color schemes in most applications, Pywal builds the color config file and sends a message to the application to reload. For terminals, it does something different. It uses <a href="https://en.wikipedia.org/wiki/ANSI_escape_code">ANSI escape codes</a>, invisible character sequences that give a terminal color and formatting instructions, to instantly swap out the colors.</p>
<p>You can see how this works in Pywal&rsquo;s <a href="https://github.com/dylanaraps/pywal/blob/master/pywal/sequences.py">sequences.py</a>. The conversion from the JSON hex color to the terminal readable escape sequence is here:</p>
<pre><code># from pywal/sequences.py
def set_color(index, color):
    &quot;&quot;&quot;Convert a hex color to a text color sequence.&quot;&quot;&quot;
    if OS == &quot;Darwin&quot; and index &lt; 20:
        return &quot;\033]P%1x%s\033\\&quot; % (index, color.strip(&quot;#&quot;))

    return &quot;\033]4;%s;%s\033\\&quot; % (index, color)
</code></pre><p>Escape sequences, which I&rsquo;ve only seen otherwise in terminal prompt customizations, are not easy to parse or write for a human, but as part of a script they&rsquo;re a powerful way to achieve instant terminal color palette swaps. I don&rsquo;t think anyone would design an API featuring anything like escape sequences today, but in this case they make for a much smoother experience than a &ldquo;change config and reload&rdquo; cycle.</p>
<p>Now let&rsquo;s look at how the escape sequences get sent to the terminal:</p>
<pre><code># from pywal/sequences.py
def send(colors, cache_dir=CACHE_DIR, to_send=True, vte_fix=False):
    &quot;&quot;&quot;Send colors to all open terminals.&quot;&quot;&quot;
    if OS == &quot;Darwin&quot;:
        tty_pattern = &quot;/dev/ttys00[0-9]*&quot;

    else:
        tty_pattern = &quot;/dev/pts/[0-9]*&quot;

    sequences = create_sequences(colors, vte_fix)

    # Writing to &quot;/dev/pts/[0-9] lets you send data to open terminals.
    if to_send:
        for term in glob.glob(tty_pattern):
        util.save_file(sequences, term)

    util.save_file(sequences, os.path.join(cache_dir, &quot;sequences&quot;))
    logging.info(&quot;Set terminal colors.&quot;)
</code></pre><p>This shows the power of Unix&rsquo;s &ldquo;everything is a file&rdquo; approach. The script locates the file for each open terminal and writes the sequences directly to it (same as you would write to a text file). And it just works.</p>
<h3 id="vim-issues">Vim issues</h3>
<p>Pywal worked beautifully for me except for Vim. It may not be an issue depending on how your Vim and terminal color schemes are configured, but in my case to get the proper color scheme I needed to not only swap the terminal colors but also toggle the <code>background</code> setting in Vim between <code>light</code> and <code>dark</code>. I eventually got this working using <code>xdotool</code> to trigger a toggle hotkey in Vim, but it was not nearly as clean a process as the main <code>write directly to terminal</code> Pywal approach. So I went hunting for other solutions.</p>
<h2 id="base16">Base16</h2>
<p><a href="https://github.com/chriskempson/base16">Base16</a> is a standardized format for creating 16-color terminal color schemes. Those color schemes can then be combined with templates to produce color configurations for a wide range of applications. <a href="https://github.com/chriskempson/base16-shell">Base16 shell</a> is a set of scripts that converts those color schemes into escape sequences to be applied to terminals.</p>
<p>The main draw for me for Base16 was that their <a href="https://github.com/chriskempson/base16-vim">Vim package</a> lets you set a base Vim color scheme that works wonderfully with any Base16 terminal color scheme, no <code>background</code> setting change needed. (Pywal does also have a version of this, but I was much less impressed with the base Pywal Vim color scheme.)</p>
<h3 id="applying-base16-to-all-open-terminals">Applying Base16 to all open terminals</h3>
<p>Base16 shell, unlike Pywal, only applies the new color scheme to your current terminal. This set-up has its own interesting possibilities (different color schemes for terminals where you <code>ssh</code>ed; random color scheme for each new terminal) but I wanted the color scheme to be applied globally. So I frankensteined a bit of Pywal into the Base16 shell script:</p>
<pre><code># Modified Base16 shell script
...
terms=`ls /dev/pts/[0-9]*`
terms=&quot;${terms} $PWD/.cache/base16/sequences&quot;
for term in $terms
do
  # 16 color space
  put_template 0  $color00
  ...
done
...
</code></pre><p>I converted the Pywal <code>send</code> function into Bash, and wrapped the part of the shell script that sent the escape sequences. I also set it to save the sequences to a cache, to be run for each new terminal. This got me the exact terminal and Vim color swap I wanted. I set up a toggle script and assigned a hotkey using my window mananger <code>i3wm</code>. If I want to swap color palettes on other applications, I can add the necessary steps into the toggle script. I like knowing exactly what the toggle script is doing, vs. Pywal&rsquo;s &ldquo;we&rsquo;ll try and take care of everything we can&rdquo;.</p>
<figure>
    <img src="/images/gif-2020-07-11_08-51-21@2x-1594472001.gif"/> <figcaption>
            <h4>The final result.</h4>
        </figcaption>
</figure>

<p>I just modified the shell scripts for the specific gruvbox color schemes I wanted, but the cleaner way to do it would be to modify the shell template and regenerate them all. For now, I&rsquo;m happy I got everything working and learned more about escape sequences and the structure of the Linux file system in the process.</p>
<h2 id="lessons-learned">Lessons learned</h2>
<p>Part of why I&rsquo;m exploring Linux and scripting is to get a feel for how software could be more customizeable. A few things were especially interesting to me here:</p>
<ol>
<li>Writing to all open terminals is a great example of the power of &ldquo;everything is a file&rdquo;. Being able to locate all the open terminals and send the escape sequences to them through the file system interface shifted my mental model about scripting possibilities. I usually think of applications and files as very separate, and this blurred that a bit. I&rsquo;d seen people talk about the power of the file concept before but this is one of the first times its been useful for something I was trying to do. I will spend some time thinking about how the file system concept could be applied to the software I make.</li>
<li>Escape sequences. I&rsquo;m trying to think if you would ever want to include them (or a concept like them) in an application created from scratch. I don&rsquo;t think so. They&rsquo;re useful when you want to do formatting and the only interface you have with the program is that you can write text characters to it. The style is embedded in the text, but because the embedding is invisible it&rsquo;s going to be pretty unpredictable if you try and move it between programs.</li>
<li>The power of plain text and the being able to manipulate plain text. Lots of the config files for Linux applications are in a simple, plain text format. Coming from Javascript, I&rsquo;m more used to intaking data as JSON and doing the manipulation in Javascript. In Linux you&rsquo;re more likely to manipulate the text directly, and there&rsquo;s a bunch of tools to help you do this. I&rsquo;m sure that in some respects this leads to more formatting edge-case errors, but there&rsquo;s also a beauty to the simplicity. You can see this in how Pywal handles changing color config for a lot of applications: generate a color config in the proper format, then just include that in the larger appplication configuration.</li>
</ol>
</div>
        <div><a href="/posts/2020-07-12-swapping-color-schemes-across-all-terminals-and-vim-with-pywal-and-base16/">Permalink</a></div>
        <div class="spacer"></div>
        <div class="spacer"></div>
      </div>
      
      
      <div class="post">
        <div class="jbm">2020.06.25</div>
        <h1><a href="/posts/2020-06-25-vimlike/">Vimlike</a></h1>
        <div><p>This <a href="https://twitter.com/helvetica/status/1274450330726645762">thread</a>, by Zach Gage, on how genre conventions serve as interaction shortcuts, got me thinking about how I use Vim conventions in my creative tools at <a href="https://constraint.systems">Constraint Systems</a>.</p>
<p><a href="https://twitter.com/helvetica/status/1274450330726645762:">https://twitter.com/helvetica/status/1274450330726645762:</a></p>
<blockquote>
<p>7/ A big part of making games involves working with genre literacy. In game design a key concept is the idea of weight: Every rule you add has a cognitive load on the player, and you must balance the weight of your rules against how meaningful they are to the play experience.</p>
</blockquote>
<blockquote>
<p>8/ An idea might be great, but if it makes the game unwieldy, ditch it. But genre-conventions are different &ndash; they&rsquo;re weightless. They allow for an increased complexity and nuance in games, because they let designers include a huge number of rules without adding any weight.</p>
</blockquote>
<p>Almost all of the experiments on Constraint Systems use Vim conventions: at least the <code>hjkl</code> characters for movement. One of the big reasons I started the experiments was my fascination with how I felt using Vim in the terminal. The combination of a strict character grid and keyboard controls provide a feeling of stability, and through that calm, that I don&rsquo;t feel in other programs, or using a computer in general.</p>
<p>This was especially in contrast to how I&rsquo;ve felt when making gestural interface, or ones that simulate physics. Building those often felt like piling on edge-case handler on top of edge-case handler. If you did it well you could make a pleasing user experience, as long as they stuck to the path you had prepared. If they wanted to go a different direction, or you wanted to take the program in a new direction, you had to deal with that unwieldy tower, either by rearchitecting it or by adding even more code for handling the new edge cases.</p>
<p>I wanted to strip things down, and see if I could start from a more stable foundations, and I turned to Vim conventions to do that. It was a natural choice because I was chasing that feeling from Vim. Choosing Vim also gave me the interaction bootstrapping effect that Zach is talking about. Rather than asking the user to start from interaction scratch, I had the Vim foundation. That&rsquo;s not directly relevant for the majority of people, Vim is only used a subset of programmers, so it doesn&rsquo;t solve everything, but it is a place to start.</p>
<p>Even for users not familiar with Vim conventions, I think there&rsquo;s a benefit to starting the experiments there, rather than trying to introduce a new paradigm. Vim has proven itself to at least be useful to many people (and inspired a lot of loyalty). So there&rsquo;s an implicit promise that even if this looks weird, you know it can be learned and at least some people have found it useful.</p>
<p>There&rsquo;s a whole series of <a href="https://reversed.top/2016-08-13/big-list-of-vim-like-software/">Vim-like programs</a>, mostly terminal-based, that use similar key combinations. There&rsquo;s also a number of browser extensions that let you <a href="https://vim.fandom.com/wiki/Vim_key_bindings_for_web_browsers">use Vim keybindings in the browser</a>. Tiling window managers (I use <a href="https://i3wm.org/">i3wm</a>) also share a lot of conventions. Putting these all together, you can put together a system for daily use that is keyboard-focused and mostly Vim-based. I&rsquo;ve started referring to the Constraint Systems experiments as &ldquo;alternative&rdquo; interfaces. Vimlike interfaces are arguably the longest running, most fully fleshed out alternative interface for computers. I want to add to and learn from that system, and keep it alive in the face of the conventions (often imported from mobile/touchscreen design) that are dominating today.</p>
</div>
        <div><a href="/posts/2020-06-25-vimlike/">Permalink</a></div>
        <div class="spacer"></div>
        <div class="spacer"></div>
      </div>
      
    <div>***</div>
    <div class="spacer"></div>
 </div>
  </div>

    <div class="container indent">
     <div>About</div>
      <p>Grant Custer is a designer-programmer interested in alternative interfaces.</p>
      <p>You can see work and inspiration in progress on my <a href="https://feed.grantcuster.com">Feed</a>  and my alternative interface experiments on <a href="https://constraint.systems">Constraint Systems</a>. I also design and build prototypes for <a href="https://blog.fastforwardlabs.com">Cloudera Fast Forward</a>. I’m happy to talk on <a href="https://twitter.com/grantcuster">Twitter</a>, email: grantcuster at gmail dot com, or <a href="https://vis.social/@grantcuster">Mastodon</a>. You can see a full list of projects on my <a href="https://grantcuster.com">Index</a>.</p>
      </p>
    </div>
    <div class="spacer"></div>
    <div class="spacer"></div>
  </body>
</html>
